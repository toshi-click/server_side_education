# サーバサイドエンジニア教育用カリキュラム
この文書は、カタリストシステムで必須とされるPHPとその周辺技術の基礎を習得するための教育用カリキュラムです。  
受講者の能力によらず、必ず一通りのステップを実施していただきます。  
研修期間は約1ヶ月間を想定しています。  
すべてのステップを完了した時点で研修修了となります。

本カリキュラムでは、以下の登場人物を想定しています。

- 受講者 : 本カリキュラムの受講者です。
- メンター : 受講者の教育・指導・助言を行います。  
また、受講者と相談して仕様を一緒に決めたりする役割も担います。  
指導について、メンターがどの程度関与するかどうかはメンターの裁量に一任します。  
また、研修期間については、受講者のスキルレベルや社内の案件状況を考慮して、メンターの方であらかじめ目安を設定する予定です。

# 概要
## システムの要件
本カリキュラムでは、課題として別途存在するPHP研修に沿った開発をしていただきます。  
PHP研修では、PHPの基礎的な使用法や、DB(データベース)と連携したWEBアプリケーションを作成します。

## サポートブラウザ
- Chrome最新版

## サーバーの構成について
下記のOS(オペレーティング・システム)・言語・ミドルウェアを使って構築していただきます。  
いずれも最新の安定バージョンを使用してください。
- VirtualBox
- CentOS
- PHP
- Apache HTTP Server
- PostgreSQL
- Ansible
- Docker

サーバーについては下記を利用してください。
- 開発
  - 自分のPC上の仮想マシン(以下VMとします)
- メンター確認環境
  - 自分のPC上のVM  
※ 性能要求は特に定めませんが、一般的な品質で作ってください。  
あまりにサイトのレスポンスが悪い場合は改善をしていただきます。  

# 本カリキュラムの最終目標
本カリキュラムの終了時点で、以下の項目を習得することを想定しています。
- PHPを利用した基本的なWebアプリケーションの実装ができるようになること
- Infrastructure as Codeを意識したサーバー構築ができるようになること
- 適切な検索語句でインターネット上の情報を検索できるようになること
- PHPアプリケーションで一般的な環境を使ってアプリケーションを作成できること
- 作成したPHPアプリケーションに対して、機能の追加やデータのメンテナンスができること
- GitLabでMRをしてマージする一連の流れを習得すること。また、それに必要なGitのコマンドを習得すること
- 適切な粒度でコミットができること
- 適切にマージリクエスト（以下MR）の説明文が書けること
- レビューに対する対応と修正が一通りできること
- 不明な点を適切なタイミングでチームメンバーや関係者に（今回はメンターになります）口頭やチャットなどで質問ができること
 
# 課題ステップ
ステップ毎にMRを作成し、メンターに確認してもらう形とします

# ステップ1: 事前準備
#### 1-1 サーバ構築ツール事前準備
- [VirtualBox](https://www.virtualbox.org/)より最新版をダウンロードし、VirtualBoxをインストールしてください  
- [CentOS](https://www.centos.org/download/)より最新版のISOファイルをダウンロードしてください

#### 1-2 GitLabにリポジトリを作成しよう
- 手元にGitをインストールしましょう
    - macOSの場合は`brew`などでインストールしてください
    - `gitconfig` でユーザ名、メールアドレスを登録しましょう

#### 1-3 リポジトリを作成しましょう
- Gitlabのアカウントがない場合はメンターへ確認してください
- その上で空のリポジトリを作成します。リポジトリ名はメンターと相談してください

#### 1-4 リポジトリをクローンしましょう
- Gitlabに作成したリポジトリを自分のPCにクローンしてください
- Windowsの場合はファイルパス長制限にならないように`C:\git\【リポジトリ名】`のように短いパスにしましょう

# ステップ2: PHPの開発環境をインストールしよう
#### 2-1 サーバーセットアップ
- VirtualBoxで新規VMを作成し、ダウンロードしておいたCentOSをインストールしてください  
- `cat /etc/redhat-release`でCentOSのバージョンが表示されることを確認してください  
- VirtualBoxの共有フォルダ機能を使用してクローンしたリポジトリをVM内にマウントしてください
- これ以降は、各手順を控えておき、メンターが再現可能なように手順書を作成してGitコミットしてください

#### 2-2 Webサーバー(Apache HTTP Server)のインストール
- [公式ページ](https://httpd.apache.org/)より最新バージョンのソースコードをダウンロードしてインストールしてください  
- `httpd -v` コマンドでhttpdのバージョンが表示されることを確認してください

#### 2-3 データベース（PostgreSQL）のインストール
- [公式ページ](https://www.postgresql.org/)より最新バージョンのソースコードをダウンロードしてインストールしてください  
- `psql --version` コマンドでPostgreSQLのバージョンが表示されることを確認してください

#### 2-4 PHPのインストール
- [公式ページ](http://php.net/)より最新バージョンのソースコードをダウンロードしてインストールしてください  
- PHPからPostgreSQLへ接続できるようにインストールしてください  
- `php -v` コマンドでPHPのバージョンが表示されることを確認してください

# ステップ3: PHPの開発環境をセットアップしよう
#### 3-1 htmlを表示しよう
- リポジトリ内に`htdocs`フォルダを作成してください
- 作成した`htdocs`フォルダ内に`hello world`と1文書いたHTMLファイルを作成してください
- Webサーバーの設定変更を行い、作成したHTMLファイルを表示できるようにしてください

#### 3-2 phpinfoを表示しよう
- この課題プロジェクト内の`phpinfo.php`を`htdocs`フォルダ内にコピーしてください
- WEBサーバー及びPHPの設定変更を行い、phpinfoが表示できるようにしてください
- phpinfoでpgsqlが表示されることを確認してください

ここまでで行なってきた内容は、どうだったでしょうか。とても多くのコマンドを実行することが必要で、コマンド実行忘れや、コマンドの打ち間違いが発生しうる内容になったかと思います。  
2000年代にはこのようなサーバー構築が一般的でしたが、2010年代の現在大部分を自動化することが出来るようになっています。  
そこで、これまで行なってきた内容をモダンに自動化してもらいます。  

# ステップ4: 環境設定自動化
#### 4-1 自動化準備
- [Vagrant](https://www.vagrantup.com/downloads.html)をダウンロードしてインストールしてください
- [公式ドキュメント](https://www.vagrantup.com/docs/provisioning/basic_usage.html)を参考にリポジトリ内に`Vagrantfile`を作成してください
- 使用するBoxファイルは`centos/7`としてください

#### 4-2 サーバー設定の自動化
- Vagrantの機能[ansible_local](https://www.vagrantup.com/docs/provisioning/ansible_local.html)で`playbook`を実行してタイムゾーン設定やロケールの設定をしてください
- `timedatectl`コマンドでタイムゾーンが`Asia/Tokyo`になっていることを確認してください
- `localectl status`コマンドで`ja_JP.UTF-8`になっていることを確認してください

#### 4-3 自動化ソフトウェアの自動インストール
- Vagrantの機能[ansible_local](https://www.vagrantup.com/docs/provisioning/ansible_local.html)で`playbook`を実行して`Docker`と`Docker-compose`をインストールしましょう
- `docker -v`コマンドでDockerバージョンが表示されることを確認してください
- `docker-compose -v`コマンドでDocker Composenoバージョンが表示されることを確認してください

# ステップ5: ミドルウェア構築自動化
#### 5-1 Webサーバー及びPHP実行環境のコンテナ化
- リポジトリ内に`docker`フォルダを作成してください
- 作成した`docker`フォルダ内に`apache`フォルダを作成してください
- 作成した`apache`フォルダ内に`Dockerfile`を作成してください
- [Dockerリファレンス](http://docs.docker.jp/engine/reference/builder.html)を参考に`Dockerfile`を作成し、Apache-PHP実行環境の構築を自動化してください
- ステップ3で作成したphpinfoを表示出来るようにしてください
- 使用するベースコンテナは`centos:latest`とします

#### 5-2 データベース（PostgreSQL）のコンテナ化
- リポジトリ内の`docker`フォルダ内に`postgres`フォルダを作成してください
- 作成した`apache`フォルダ内に`Dockerfile`を作成してください
- 5-1と同様にリファレンスを参考にデータベースサーバーの構築を自動化してください
- 使用するベースコンテナは`centos:latest`とします

#### 5-3 WEBサーバーコンテナとデータベースコンテナを連携させる
- WEBサーバーからデータベースコンテナにアクセスが出来るようにする
- `docker run`コマンドを使用して2つのコンテナを連携出来るようにすること
- `docker exec -it [WEBサーバーコンテナ名] /bin/bash`でWEBサーバーコンテナに入り、`psql`コマンドでデータベースコンテナにアクセス出来ることを確認する
 
#### 5-4 docker-composeで`docker run`を定義する
- リポジトリ内の`docker`フォルダ内に`docker-compose.yml`ファイルを作成してください
- [Docker Composeリファレンス](http://docs.docker.jp/compose/compose-file.html)を参考にWEBサーバーコンテナとデータベースコンテナを定義してください
- `docker-compose up -d`コマンドでコンテナが起動し、連携できていることを確認してください

